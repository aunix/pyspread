#!/usr/bin/env python
# -*- coding: utf-8 -*-

# Copyright 2008 Martin Manns
# Distributed under the terms of the GNU General Public License
# generated by wxGlade 0.6 on Mon Mar 17 23:22:49 2008

# --------------------------------------------------------------------
# pyspread is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# pyspread is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with pyspread.  If not, see <http://www.gnu.org/licenses/>.
# --------------------------------------------------------------------

"""
Selection
=========

Grid selection representation

"""

class Selection(object):
    """Represents grid selection
    
    Parameters
    ----------
    
    block_top_left: List of 2-tuples
    \tTop left edges of all selection rectangles
    block_bottom_right: List of 2-tuples
    \tBottom right edges of all selection rectangles
    rows: List
    \tList of selected rows
    cols: List
    \tList of selected columns
    cells: List of 2-tuples
    \tList of (row, column) tuples of individually selected cells
    
    """
    
    def __init__(self, block_top_left, block_bottom_right, rows, cols, cells):
        self.block_tl = block_top_left
        self.block_br = block_bottom_right
        self.rows = rows
        self.cols = cols
        self.cells = cells
    
    def __nonzero__(self):
        """Returns True iif any attribute is non-empty"""
        
        return any((self.block_tl, 
                    self.block_br, 
                    self.rows,
                    self.cols, 
                    self.cells))
    
    def __repr__(self):
        """String output for printing selection"""
        
        return "Selection" + repr( \
                   (self.block_tl, 
                    self.block_br, 
                    self.rows,
                    self.cols, 
                    self.cells))
    
    def __contains__(self, cell):
        """Returns True iif cell is in selection
        
        Parameters
        ----------
        
        cell: 2-Tuple
        \tIndex of cell that is checked if it is inside selection.
        
        """
        
        assert len(cell) == 2
        
        cell_row, cell_col = cell
        
        # Block selections
        for top_left, bottom_right in zip(self.block_tl, self.block_br):
            top, left = top_left
            bottom, right = bottom_right
            
            if top <= cell_row <= bottom and left <= cell_col <= right:
                return True
        
        # Row and column selections
        
        if cell_row in self.rows or cell_col in self.cols:
            return True
        
        # Cell selections
        if cell in self.cells:
            return True
        
        return False

    def get_bbox(self):
        """Returns top left and bottom right of bounding box
        
        A bounding box is the smallest rectangle that contains all selections.
        
        """
        
        bb_top, bb_left, bb_bottom, bb_right = [None] * 4
        
        # Block selections
        
        for top_left, bottom_right in zip(self.block_tl, self.block_br):
            top, left = top_left
            bottom, right = bottom_right
            
            if bb_top is None or bb_top > top:
                bb_top = top
            if bb_left is None or bb_left > left:
                bb_left = left
            if bb_bottom is None or bb_bottom < bottom:
                bb_bottom = bottom
            if bb_right is None or bb_right > right:
                bb_right = right
        
        # Row and column selections
        
        for row in self.rows:
            if bb_top is None or bb_top > row:
                bb_top = row
            if bb_bottom is None or bb_bottom < row:
                bb_bottom = row
        
        for col in self.cols:
            if bb_left is None or bb_left > col:
                bb_left = col
            if bb_right is None or bb_right < col:
                bb_right = col
        
        # Cell selections
        
        for cell in self.cells:
            cell_row, cell_col = cell
            
            if bb_top is None or bb_top > cell_row:
                bb_top = cell_row
            if bb_left is None or bb_left > cell_col:
                bb_left = cell_col
            if bb_bottom is None or bb_bottom < cell_row:
                bb_bottom = cell_row
            if bb_right is None or bb_right < cell_col:
                bb_right = cell_col
        
        if all(val is None for val in [bb_top, bb_left, bb_bottom, bb_right]):
            return None
        
        return ((bb_top, bb_left), (bb_bottom, bb_right))
